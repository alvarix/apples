<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apples</title>
  <!-- HTMX for AJAX requests -->
  <script src="https://unpkg.com/htmx.org"></script>
  <!-- Alpine.js for interactivity -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <link rel="stylesheet" href="/css/tw.css">
  <link rel="stylesheet" href="/css/styles.css">
 

  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
  <link rel="shortcut icon" href="/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="/favicon/site.webmanifest" />
</head>
<body>
<main class="overflow-visible">
  <div class="flex justify-between items-center">

    <h1 clas="mt-32"> <span class="text-2xl font-bold text-red-500">apples</span></h1>
    <div class="flex flex-col">
      <button id="btn-pop-1" class='btn-sm' popovertarget="popover">About</button>
    </div>

    </div>

  <form
    class="textlxl md:text-2xl"
    id="x"
    hx-post="/api/add-expense"
    hx-trigger="submit"
    hx-target="#expenses"
    hx-swap="innerHTML"
    x-data="{ lastPayer: localStorage.getItem('lastPayer') || 'Adam' }"
    x-init="$watch('lastPayer', value => localStorage.setItem('lastPayer', value))"
    @submit="document.getElementById('balance').classList.add('loading-pulse')"
    @htmx:after-request="$event.detail.successful && ($refs.description.value = ''; $refs.amount.value = ''); htmx.trigger('body', 'balanceUpdate')"
    >
    <div>
      <label>
        <input type="radio" name="payer" value="Adam" x-model="lastPayer" required/> Adam
      </label>
      <label>
        <input type="radio" name="payer" value="Eve" x-model="lastPayer" required/> Eve
      </label>
    </div>
    <div>
        <input type="text" name="description" placeholder="Description" required x-ref="description" />
    </div>
    <div>
        <input type="number" name="amount" placeholder="$ Amount" required step="0.01" x-ref="amount" />
    </div>
    <div class="flex gap-2">
        <button type="submit" name="type" value="expense">Add Expense</button>
        <button type="submit" name="type" value="loan">Loan</button>
        <button type="submit" name="type" value="settlement" class="bg-green-600 text-white">Settle</button>
    </div>
  </form>
  <h2 class="my-24">
    <span style="font-weight: normal;" id="balance"
          hx-get="/api/balance"
          hx-trigger="load, every 5s, balanceUpdate from:body"
          class="transition-all duration-300"
          @htmx:after-swap="this.classList.remove('loading-pulse')"></span>
  </h2>
  <div id="expenses" class='flex-col md:flex-row gap-8 flex flex-wrap' hx-get="/api/expenses" hx-trigger="load"></div>
</main>







<div id="popover" popover="manual">
  <aside class="my-0">
    <p>
      This app was built by <a target="_blank" href="https://github.com/alvarix">Alvar</a> as a mini expense tracker for him and
      <a target="_blank" href="https://noelletimmons.com/">Noelle</a>.
      <span class="text-red-500">Please dont modify!</span>
      It's a simple app that allows us to add expenses and see the balance between us.
      <p class="mt-2">It uses HTMX and Alpine for the frontend, Fastify and Postgres for the backend.</p>
    </aside>
  </div>


</body>
</html>